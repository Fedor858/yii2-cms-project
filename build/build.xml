<?xml version="1.0"?>
<project name="mysite.com" default="help">
    <target name="build">
        <echo>Deploying application...</echo>
        <property name="execoutput" value="" />
        <property name="home" value="/var/www/mysite" />
        <property name="host" value="mysite.com" />
        <property name="username" value="ubuntu" />
        <property name="sshPath" value="/home/me/.ssh" />
        <exec
                command="rsync
                --recursive
                --links
                --compress
                --compress-level=9
                --delete-after
                -e 'ssh -c arcfour -o Compression=no -x'
                --exclude-from=${project.basedir}/exclude.txt
                ${project.basedir}/../
                ${username}@${host}:${home}/"
                outputProperty="execoutput"
                />

        <if>
            <equals arg1="${init}" arg2="true" />
            <then>
                <echo>Initializing app</echo>
                <ssh host="${host}" username="${username}"
                     pubkeyfile="${sshPath}/id_rsa.pub"
                     privkeyfile="${sshPath}/id_rsa"
                     command='
                        cd ${home}
                        ; sh build/build.sh init
                ' />
            </then>
            <else>
                <ssh host="${host}" username="${username}"
                     pubkeyfile="${sshPath}/id_rsa.pub"
                     privkeyfile="${sshPath}/id_rsa"
                     command="cd ${home}
                        ;sh build/build.sh update" />
            </else>
        </if>
    </target>
    <target name="help">
        <echo>Use "phing build" command</echo>
    </target>
</project>
